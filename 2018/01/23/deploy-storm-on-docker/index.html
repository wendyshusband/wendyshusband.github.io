<!DOCTYPE html>
<html>
<head>
    

    

    



    <meta charset="utf-8">
    
    
    
    <title>Deploy-storm-on-docker | CollinT | 知我者，谓我心忧；不知我者，谓我何求。</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    
    <meta name="theme-color" content="#077060">
    
    
    <meta name="keywords" content="Distributed system,Docker,Apache Storm">
    <meta name="description" content="Welcome to contribute to  our documentation on github.">
<meta name="keywords" content="Distributed system,Docker,Apache Storm">
<meta property="og:type" content="article">
<meta property="og:title" content="Deploy-storm-on-docker">
<meta property="og:url" content="http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/index.html">
<meta property="og:site_name" content="CollinT">
<meta property="og:description" content="Welcome to contribute to  our documentation on github.">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://github.com/ADSC-Resa/documentation/wiki/1.png">
<meta property="og:image" content="https://github.com/ADSC-Resa/documentation/wiki/2.png">
<meta property="og:updated_time" content="2018-01-26T14:43:28.311Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Deploy-storm-on-docker">
<meta name="twitter:description" content="Welcome to contribute to  our documentation on github.">
<meta name="twitter:image" content="https://github.com/ADSC-Resa/documentation/wiki/1.png">
    
        <link rel="alternate" type="application/atom+xml" title="CollinT" href="/atom.xml">
    
    <link rel="shortcut icon" href="/img/favicon.ico">
    <link rel="stylesheet" href="/css/style.css?v=1.6.11">
    <script>window.lazyScripts=[]</script>
</head>

<body>
    <div id="loading" class="active"></div>

    <aside id="menu" class="hide" >
  <div class="inner flex-row-vertical">
    <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menu-off">
        <i class="icon icon-lg icon-close"></i>
    </a>
    <div class="brand-wrap" style="background-image:url(/img/brand.jpg)">
      <div class="brand">
        <a href="/" class="avatar waves-effect waves-circle waves-light">
          <img src="/img/logo.jpg">
        </a>
        <hgroup class="introduce">
          <h5 class="nickname">CollinT</h5>
          <a href="mailto:tkl449@126.com" title="tkl449@126.com" class="mail">tkl449@126.com</a>
        </hgroup>
      </div>
    </div>
    <div class="scroll-wrap flex-col">
      <ul class="nav">
        
            <li class="waves-block waves-effect">
              <a href="/"  >
                <i class="icon icon-lg icon-home"></i>
                主页
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/archives"  >
                <i class="icon icon-lg icon-archives"></i>
                时间轴
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/tags"  >
                <i class="icon icon-lg icon-tags"></i>
                标签
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/categories"  >
                <i class="icon icon-lg icon-th-list"></i>
                分类
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://github.com/wendyshusband" target="_blank" >
                <i class="icon icon-lg icon-github"></i>
                Github
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.douban.com/people/123162274/" target="_blank" >
                <i class="icon icon-lg icon-pencil"></i>
                豆瓣
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="https://www.zhihu.com/people/tang-kai-lin-53/activities" target="_blank" >
                <i class="icon icon-lg icon-book"></i>
                知乎
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://www.dmirlab.com/" target="_blank" >
                <i class="icon icon-lg icon-university"></i>
                DMIR
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="http://blog.tangkailin.cn/2018/01/27/%E6%9C%89%E4%BA%9B%E4%BA%BA%E6%98%AF%E6%B3%A8%E5%AE%9A%E6%B2%A1%E6%9C%89%E6%A2%A6%E6%83%B3%E7%9A%84/" target="_blank" >
                <i class="icon icon-lg icon-balance-scale"></i>
                推荐站点
              </a>
            </li>
        
            <li class="waves-block waves-effect">
              <a href="/atom.xml" target="_blank" >
                <i class="icon icon-lg icon-rss"></i>
                RSS订阅
              </a>
            </li>
        
      </ul>
    </div>
  </div>
</aside>

    <main id="main">
        <header class="top-header" id="header">
    <div class="flex-row">
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light on" id="menu-toggle">
          <i class="icon icon-lg icon-navicon"></i>
        </a>
        <div class="flex-col header-title ellipsis">Deploy-storm-on-docker</div>
        
        <div class="search-wrap" id="search-wrap">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="back">
                <i class="icon icon-lg icon-chevron-left"></i>
            </a>
            <input type="text" id="key" class="search-input" autocomplete="off" placeholder="输入感兴趣的关键字">
            <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="search">
                <i class="icon icon-lg icon-search"></i>
            </a>
        </div>
        
        
        <a href="javascript:;" class="header-icon waves-effect waves-circle waves-light" id="menuShare">
            <i class="icon icon-lg icon-share-alt"></i>
        </a>
        
    </div>
</header>
<header class="content-header post-header">

    <div class="container fade-scale">
        <h1 class="title">Deploy-storm-on-docker</h1>
        <h5 class="subtitle">
            
                <time datetime="2018-01-23T14:59:09.000Z" itemprop="datePublished" class="page-time">
  2018-01-23
</time>


	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Storm知识/">Storm知识</a></li></ul>

            
        </h5>
    </div>

    


</header>


<div class="container body-wrap">
    
    <aside class="post-widget">
        <nav class="post-toc-wrap" id="post-toc">
            <h4>TOC</h4>
            <ol class="post-toc"><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Overall-Architecture"><span class="post-toc-number">1.</span> <span class="post-toc-text">Overall Architecture</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Install-Docker"><span class="post-toc-number">2.</span> <span class="post-toc-text">Install Docker</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Create-etc-init-sh"><span class="post-toc-number">3.</span> <span class="post-toc-text">Create /etc/init.sh</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Create-swarm-worker"><span class="post-toc-number">4.</span> <span class="post-toc-text">Create swarm worker</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Start-Docker-swarm-cluster-and-zookeeper-server"><span class="post-toc-number">5.</span> <span class="post-toc-text">Start Docker swarm cluster and zookeeper server</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Setup-the-storm-cluster"><span class="post-toc-number">6.</span> <span class="post-toc-text">Setup the storm cluster</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Topology-Deployment"><span class="post-toc-number">7.</span> <span class="post-toc-text">Topology Deployment</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Killing-a-Topology"><span class="post-toc-number">8.</span> <span class="post-toc-text">Killing a Topology</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Topology-Rebalance"><span class="post-toc-number">9.</span> <span class="post-toc-text">Topology Rebalance</span></a></li><li class="post-toc-item post-toc-level-1"><a class="post-toc-link" href="#Shutting-down-the-storm-cluster"><span class="post-toc-number">10.</span> <span class="post-toc-text">Shutting down the storm cluster</span></a></li></ol>
        </nav>
    </aside>
    
<article id="post-deploy-storm-on-docker"
  class="post-article article-type-post fade" itemprop="blogPost">

    <div class="post-card">
        <h1 class="post-card-title">Deploy-storm-on-docker</h1>
        <div class="post-meta">
            <time class="post-time" title="2018-01-23 22:59:09" datetime="2018-01-23T14:59:09.000Z"  itemprop="datePublished">2018-01-23</time>

            
	<ul class="article-category-list"><li class="article-category-list-item"><a class="article-category-list-link" href="/categories/Storm知识/">Storm知识</a></li></ul>



            
<span id="busuanzi_container_page_pv" title="文章总阅读量" style='display:none'>
    <i class="icon icon-eye icon-pr"></i><span id="busuanzi_value_page_pv"></span>
</span>


        </div>
        <div class="post-content" id="post-content" itemprop="postContent">
            <p>Welcome to contribute to  our <a href="https://github.com/ADSC-Resa/documentation" target="_blank" rel="external">documentation</a> on github.</p>
<a id="more"></a>
<p>This guide reference <a href="http://highscalability.com/blog/2016/4/25/the-joy-of-deploying-apache-storm-on-docker-swarm.html" target="_blank" rel="external">The joy of deploying Apache Storm on Docker Swarm</a> in <a href="http://www.baqend.com/" target="_blank" rel="external">Baqend Tech</a>.And we describe some of the detail and principles about every step in this tutorial.If you have already have a good use of Linux,Docker swarm and Apache storm,you can use script given in the article above for rapid deployment. This tutorial is targeted at beginner novice.We will manual configuration on each machine and you will be more clear understand the principle in the process of deployment .</p>
<p>So let’s begin :</p>
<h1 id="Overall-Architecture"><a href="#Overall-Architecture" class="headerlink" title="Overall Architecture"></a>Overall Architecture</h1><figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/ADSC-Resa/documentation/wiki/1.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>You’ll have 3 machines running Ubuntu Server 14.04, each of which will be running a Docker daemon with several containers inside. As shown in figure above ,we use ubuntu1 as manager of Docker swarm. The Nimbus and UI containers will be spawned on the manager node (Ubuntu 1).Beside ,remember to open port 8080 for UI container.<br>When swarm is in place ,you’ll create an overlay network (stormnet) to enable communication between Docker container hosted on the different swarm nodes. Finally, you will set up a full-fledged storm cluster that uses the existing zookeeper ensemble for coordination and stormnet for inter-node communication. This involves discovery service of Docker swarm ,you can read <a href="https://technologyconversations.com/2015/09/08/service-discovery-zookeeper-vs-etcd-vs-consul/" target="_blank" rel="external">here</a>.<br>We are using hostnames dmir1,dmir2 and dmir3 for the three Ubuntu machines. Using alias rather than an IP address can have better fault tolerance. At the time of the actual deployment ,remember to replace your own domain name. Three zookeeper severs are deployed here, of course,using one zookeeper is also possible. </p>
<h1 id="Install-Docker"><a href="#Install-Docker" class="headerlink" title="Install Docker"></a>Install Docker</h1><p>Using your favorite way to connect three machines and install Docker on each machine. You can reference <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/" target="_blank" rel="external">here</a> to install Docker. After the installation is complete,we should test to ensure that the installation is successful.</p>
<h1 id="Create-etc-init-sh"><a href="#Create-etc-init-sh" class="headerlink" title="Create /etc/init.sh"></a>Create /etc/init.sh</h1><p>Create the file used to configure the Docker swarm worker.</p>
<p>In the terminal ,type :</p>
<blockquote>
<p>sudo touch /etc/init.sh<br>sudo vim /etc/init.sh</p>
</blockquote>
<p>and then paste the following and save:</p>
<blockquote>
<p>#!/bin/bash<br># first script argument: the servers in the ZooKeeper ensemble:<br>ZOOKEEPER_SERVERS=$1<br># second script argument: the role of this node:<br># (“manager” for the Swarm manager node; leave empty else) ROLE=$2 # the IP<br>address of this machine:<br>PRIVATE_IP=$(/sbin/ifconfig eth0 | grep ‘inet addr:’ | cut -d: -f2 | awk ‘{ print &gt;$1}’)<br># define label for the manager node: if [[ $ROLE == “manager” ]];then LABELS=”–<br>label server=manager”;else LABELS=””;fi<br># define default options for Docker Swarm:<br>echo “DOCKER_OPTS=\”-H tcp://0.0.0.0:2375 -H unix:///var/run/docker.sock –cluster&gt;-advertise eth0:2375 $LABELS –cluster-store zk://$ZOOKEEPER_SERVERS\”” | sudo<br>tee /etc/default/docker<br># restart the service to apply new options:<br>sudo service docker restart<br>echo “let’s wait a little…”<br>sleep 10<br># make this machine join the Docker Swarm cluster:<br>docker run -d –restart=always swarm join –advertise=$PRIVATE_IP:2375<br>zk://$ZOOKEEPER_SERVERS  </p>
</blockquote>
<p>In this shell file, we configure some detail for start a swarm worker. The first step , we defined three zookeeper server node ,through the ZOOKEEPER_SERVERS variable. The second step, we parse <em>/sbin/ifconfig eth0</em> to get the IP address of the machine($PRIVATE_IP). The third step, we mark the label “manager ” for swarm manager node. The fourth step, modify <em>/ect/default/docker</em>, including some content such as docker daemon listening port 2375,which can refer to the configuration of the docker on the <a href="https://docs.docker.com/" target="_blank" rel="external">https://docs.docker.com/</a>. The fifth step, restart Docker service. The last step, <em>docker run</em> a swarm worker container ,and use zookeeper as the service discovery.  </p>
<h1 id="Create-swarm-worker"><a href="#Create-swarm-worker" class="headerlink" title="Create swarm worker"></a>Create swarm worker</h1><p>In the terminal of Ubuntu1 ,type :</p>
<blockquote>
<p>/bin/bash /etc/init.sh dmir1,dmir2,dmir3  manager</p>
</blockquote>
<p>In the terminal of Ubuntu2 and Ubuntu3, type :</p>
<blockquote>
<p>/bin/bash /etc/init.sh dmir1,dmir2,dmir3</p>
</blockquote>
<p>set up your DNS in such a way that the first hostname in the list (dmir1) points towards the manager on Ubuntu 1 and the other two hostnames (dmir2 and dmir3) point towards the other two machines, i.e. Ubuntu 2 and Ubuntu 3.<br>Configure your security settings to allow connections between the machines on ports 2181, 2888, 3888 (zookeeper), 2375 (Docker Swarm) and 6627 (Storm, remote topology deployment).<br>If nothing has gone wrong, you should now have three Ubuntu servers, each running a Docker daemon. Ubuntu 1 should be reachable via dmir1 in your private network. Now, we can only configuration on Ubuntu1, it is going to be the only machine you will talk to from this point on.</p>
<h1 id="Start-Docker-swarm-cluster-and-zookeeper-server"><a href="#Start-Docker-swarm-cluster-and-zookeeper-server" class="headerlink" title="Start Docker swarm cluster and zookeeper server"></a>Start Docker swarm cluster and zookeeper server</h1><p>Using <em>docker ps</em> to perform a quick heal check. If Docker is installed correctly, the terminal will show a list of the running Docker container (exactly 1 for swarm and nothing else ) </p>
<p>You are now good to launch one zookeeper node on every machine like this:</p>
<blockquote>
<p>docker -H tcp://dmir1:2375 run -d –restart=always -p 2181:2181 -p 2888:2888 -p<br>3888:3888 -v /var/lib/zookeeper:/var/lib/zookeeper -v /var/log/zookeeper:/var/log/zookeeper –name zk1 baqend/zookeeper dmir1,dmir2,dmir3 1<br>docker -H tcp://dmir2:2375 run -d –restart=always -p 2181:2181 -p 2888:2888 -p 3888:3888 -v /var/lib/zookeeper:/var/lib/zookeeper -v /var/log/zookeeper:/var/log/zookeeper –name zk2 baqend/zookeeper dmir1,dmir2,dmir3 2<br>docker -H tcp://dmir3:2375 run -d –restart=always -p 2181:2181 -p 2888:2888 -p 3888:3888 -v /var/lib/zookeeper:/var/lib/zookeeper -v /var/log/zookeeper:/var/log/zookeeper –name zk3 baqend/zookeeper dmir1,dmir2,dmir3 3  </p>
</blockquote>
<p>Here we using <a href="https://hub.docker.com/r/baqend/zookeeper/" target="_blank" rel="external">baqend/zookeeper</a> image on the docker hub.<br>By specifying the -H … argument, we are able to launch the zookeeper containers on the different host machines. The -p commands expose the ports required by zookeeper per default. The two -v commands provide persistence in case of container failure by mapping the directories the zookeeper container uses to the corresponding host directories. The comma-separated list of hostnames tells zookeeper what servers are in the ensemble. This is the same for every node in the ensemble. The only variable is the zookeeper ID (second argument), because it is unique for every container.    </p>
<p>To check zookeeper health, you can do the following:</p>
<blockquote>
<p>docker -H tcp://dmir1:2375 exec -it zk1 bin/zkServer.sh status &amp;&amp; docker -H<br>tcp://dmir2:2375 exec -it zk2 bin/zkServer.sh status &amp;&amp; docker -H<br>tcp://dmir3:2375 exec -it zk3 bin/zkServer.sh status</p>
</blockquote>
<p>Here related to Docker exec command and the zookeeper service status command bin/zkServer.sh status. If your cluster is healthy, every node will report whether it is the leader or one of the followers. If something goes wrong,likely due to $PRIVATE_IP can’t be parsed, then we recommended that removed the last step in the init.sh and manually <em>docker run</em> a swarm worker on each node.</p>
<blockquote>
<p>docker run -d –restart=always swarm join –advertise=$PRIVATE_IP:2375<br>zk://$ZOOKEEPER_SERVERS</p>
</blockquote>
<p>After you start the zookeeper service ,you need to start the swarm manager:</p>
<blockquote>
<p>docker run -d –restart=always –label role=manager -p 2376:2375 swarm<br>manage zk://dmir1,dmir2,dmir3</p>
</blockquote>
<p>Now the Swarm cluster is running. However, we still have to tell the Docker client about it. So finally, you only have to make sure that all future docker run statements are directed to the Swarm manager container (which will do the scheduling) and not against the local Docker daemon:</p>
<blockquote>
<p>cat &lt;&lt; EOF | tee -a ~/.bash_profile<br># this node is the master and therefore should be able to talk to the Swarm<br>cluster:<br>export DOCKER_HOST=tcp://127.0.0.1:2376<br>EOF</p>
</blockquote>
<p>This will do it for the current session and also make sure it will be done again when we log into the machine next time.<br>Now everything should be up and running. Type in <em>docker info</em> to check cluster status on the manager node. </p>
<p>You should see 3 running workers similar to this:</p>
<figure class="image-bubble">
                <div class="img-lightbox">
                    <div class="overlay"></div>
                    <img src="https://github.com/ADSC-Resa/documentation/wiki/2.png" alt="" title="">
                </div>
                <div class="image-caption"></div>
            </figure>
<p>The important part is the line with Status: Healthy for each node. If you observe something like Status: Pending or if not all nodes show up, even though you are not experiencing any errors elsewhere, try restarting the manager container like so:</p>
<blockquote>
<p>docker restart $(docker ps -a –no-trunc –filter “label=role=manager)</p>
</blockquote>
<h1 id="Setup-the-storm-cluster"><a href="#Setup-the-storm-cluster" class="headerlink" title="Setup the storm cluster"></a>Setup the storm cluster</h1><p>First, create the overlay network stormnet. This network is guaranteed the mapping relationship between container and physical machine.you can reference <a href="https://docs.docker.com/engine/userguide/networking/get-started-overlay/" target="_blank" rel="external">here</a>.</p>
<blockquote>
<p>docker network create –driver overlay stormnet<br>docker network ls  </p>
</blockquote>
<p>This creates a network and detect if created successfully. If something goes wrong,maybe your swarm cluster is not running. It means that you should refer to the previous tutorial and guarantee every step is carefully finished.<br>Now, let’s start storm components, including UI, nimbus and supervisor.</p>
<p>First, start the UI:</p>
<blockquote>
<p>docker run -d –label cluster=storm –label role=ui -e constraint:server==manager -e STORM_ZOOKEEPER_SERVERS=dmir1,dmir2,dmir3 –net stormnet –restart=always –name ui -p 8080:8080 baqend/storm ui</p>
</blockquote>
<p>and the nimbus :</p>
<blockquote>
<p>docker run -d –label cluster=storm –label role=nimbus -e<br>constraint:server==manager -e STORM_ZOOKEEPER_SERVERS=dmir1,dmir2,dmir3 –net<br>stormnet –restart=always –name nimbus -p 6627:6627 baqend/storm nimbus  </p>
</blockquote>
<p>For specific configuration can refer to <a href="https://hub.docker.com/r/baqend/storm/" target="_blank" rel="external">baqend/storm</a>. The -p commands expose the ports required by UI container and nimbus container default. The -net command specified the container under the stormnet, in order to communicate with the container on other physical machine.<br>Note that nimbus parameter are added after baqend/storm, when we start nimbus container. This parameter is mark the nimbus container as the main container. This involves some  configuration of baqend/storm, you can view <a href="https://github.com/Baqend/docker-storm" target="_blank" rel="external">here</a>.<br>To make sure that these are running on the manager node, we specified a <em>constraint : constraint : server==manager</em>. You can now access the Storm UI as though it would be running on the manager node, However, there are no supervisors running, yet.</p>
<p>Finally, start the supervisor, you can start supervisor on any machine. </p>
<blockquote>
<p>docker run -d –label cluster=storm –label role=supervisor -e<br>affinity:role!=supervisor -e STORM_ZOOKEEPER_SERVERS=dmir1,dmir2,dmir3 –net<br>stormnet –restart=always baqend/storm supervisor -c supervisor.slots.ports=[6700]</p>
</blockquote>
<p>Since we do not care where exactly the individual supervisors are running, we did not specify any constraints or container names here. However, in order to prevent two supervisors from being hosted on one machine, we did specify a label <em>affinity : affinity : role!=supervisor</em>. If you need more supervisor containers, you’ll have to add additional Swarm worker nodes (Ubuntu 4, Ubuntu 5, …). Besides, the <em>-c supervisor.slots.ports=[6700]</em> provided one port 6700 for supervisor. Of course you can provide any number of port for supervisor. But we recommend that you use only one port, because the container is essentially a process on physical machine , no matter how much the port resources are the same.<br>Have a look at the Storm UI and make sure that you have supervisors running.</p>
<h1 id="Topology-Deployment"><a href="#Topology-Deployment" class="headerlink" title="Topology Deployment"></a>Topology Deployment</h1><p>Deploying a topology can now be done from any server that has a Docker daemon running and is in the same network as the manager machine. The following command assumes that your topology fatjar is a file called topology.jar in your current working directory:</p>
<blockquote>
<p>docker -H tcp://127.0.0.1:2375 run -it –rm -v $(readlink -m topology.jar)<br>:/topology.jar –net stormnet baqend/storm jar /topology.jar main.class arg1 arg2</p>
</blockquote>
<p>This command will spawn a Docker container, deploy the topology and then remove the container. You should provide the <em>-H tcp://127.0.0.1:2375</em> argument to make sure the container is started on the machine you are currently working on; if you left the scheduling to Docker Swarm, the deployment might fail because the spawning host does not necessarily have the topology file.By the way, we use <em>readlink -m topology.jar</em> which produces an absolute path fortopology.jar, because relative paths are not supported. You can also provide an absolute path directly, though.<br>Last but most important , <em>–net stormnet</em> is necessary, because you spawn a new container for deploy the topology, so this new container must under the stormnet ,otherwise it will return a <em>unknownhost error</em>.</p>
<h1 id="Killing-a-Topology"><a href="#Killing-a-Topology" class="headerlink" title="Killing a Topology"></a>Killing a Topology</h1><p>Killing the topology can either be done via the Storm web UI interactively or, assuming the running topology is called runningTopology, like this:</p>
<blockquote>
<p>docker run -it –rm –net stormnet baqend/storm  kill runningTopology</p>
</blockquote>
<p>The host argument -H … is not required here, because the statement stands on its own and has no file dependencies.</p>
<h1 id="Topology-Rebalance"><a href="#Topology-Rebalance" class="headerlink" title="Topology Rebalance"></a>Topology Rebalance</h1><p>Topology rebalance can either be done via the Storm web UI interactively or, assuming the running topology is called runningTopology, like this:</p>
<blockquote>
<p>docker run -it –rm –net stormnet baqend/storm  rebalance runningTopology -n arg</p>
</blockquote>
<p>or:</p>
<blockquote>
<p>docker exec -it nimbus storm rebalance runningTopology -n arg</p>
</blockquote>
<p>Of course , we need enough slot to support this operation.</p>
<h1 id="Shutting-down-the-storm-cluster"><a href="#Shutting-down-the-storm-cluster" class="headerlink" title="Shutting down the storm cluster"></a>Shutting down the storm cluster</h1><p>Since every Storm-related container is labelled with cluster=storm, you can kill all of them with the following statement:</p>
<blockquote>
<p>docker rm -f $(docker ps -a –no-trunc –filter “label=cluster=storm”</p>
</blockquote>
<p>Finally, we finish our work. we stepped over how to <a href="https://docs.docker.com/swarm/configure-tls/" target="_blank" rel="external">configure Docker Swarm for TLS</a>. If you are planning to use Docker Swarm in a business-critical application, you should definitely put some effort into this aspect of deployment.</p>
<p>You can use our <a href="https://github.com/wendyshusband/storm-On-Docker-Swarm" target="_blank" rel="external">script</a> for repid depolyment</p>

        </div>

        <blockquote class="post-copyright">
    <div class="content">
        
<span class="post-time">
    最后更新时间：<time datetime="2018-01-26T14:43:28.311Z" itemprop="dateUpdated">2018-01-26 22:43:28</time>
</span><br>


        
        原创文章，转载请注明出处。 本文链接：<a href="/2018/01/23/deploy-storm-on-docker/" target="_blank" rel="external">http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/</a>
        
    </div>
    <footer>
        <a href="http://blog.tangkailin.cn">
            <img src="/img/logo.jpg" alt="CollinT">
            CollinT
        </a>
    </footer>
</blockquote>

        
<div class="page-reward">
    <a id="rewardBtn" href="javascript:;" class="page-reward-btn waves-effect waves-circle waves-light">赏</a>
</div>



        <div class="post-footer">
            
	<ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Apache-Storm/">Apache Storm</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Distributed-system/">Distributed system</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Docker/">Docker</a></li></ul>


            
<div class="page-share-wrap">
    

<div class="page-share" id="pageShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&title=《Deploy-storm-on-docker》 — CollinT&pic=http://blog.tangkailin.cn/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&title=《Deploy-storm-on-docker》 — CollinT&source=Welcome to contribute to  our documentation on github." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Deploy-storm-on-docker》 — CollinT&url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&via=http://blog.tangkailin.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>



    <a href="javascript:;" id="shareFab" class="page-share-fab waves-effect waves-circle">
        <i class="icon icon-share-alt icon-lg"></i>
    </a>
</div>



        </div>
    </div>

    
<nav class="post-nav flex-row flex-justify-between">
  
    <div class="waves-block waves-effect prev">
      <a href="/2018/01/23/Running-mapreduce-job-into-Docker-container/" id="post-prev" class="post-nav-link">
        <div class="tips"><i class="icon icon-angle-left icon-lg icon-pr"></i> Prev</div>
        <h4 class="title">Running-mapreduce-job-into-Docker-container</h4>
      </a>
    </div>
  

  
    <div class="waves-block waves-effect next">
      <a href="/2018/01/20/Storm中的分布式缓存/" id="post-next" class="post-nav-link">
        <div class="tips">Next <i class="icon icon-angle-right icon-lg icon-pl"></i></div>
        <h4 class="title">Storm中的分布式缓存</h4>
      </a>
    </div>
  
</nav>



    











<section class="comments" id="comments">
    <div id="gitment_thread"></div>
    <link rel="stylesheet" href="//unpkg.com/gitment/style/default.css">
    <script src="//unpkg.com/gitment/dist/gitment.browser.js"></script>
    <script>
        var gitment = new Gitment({
            owner: 'wendyshusband',
            repo: 'gitment',
            oauth: {
                client_id: 'c96780c68ae9207abc4d',
                client_secret: '5f2e7cecee60de4f69c69e66b7174e70ac76b54a',
            },
        })
        gitment.render('comments')
    </script>
</section>




</article>

<div id="reward" class="page-modal reward-lay">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <h3 class="reward-title">
        <i class="icon icon-quote-left"></i>
        谢谢~
        <i class="icon icon-quote-right"></i>
    </h3>
    <div class="reward-content">
        
        <div class="reward-code">
            <img id="rewardCode" src="/img/wechat.jpg" alt="打赏二维码">
        </div>
        
    </div>
</div>



</div>

        <footer class="footer">
    <div class="top">
        
<p>
    <span id="busuanzi_container_site_uv" style='display:none'>
        总访客数：<span id="busuanzi_value_site_uv"></span>
    </span>
    <span id="busuanzi_container_site_pv" style='display:none'>
        总访问量：<span id="busuanzi_value_site_pv"></span>
    </span>
</p>


        <p>
            <!--
                <span><a href="/atom.xml" target="_blank" class="rss" title="rss"><i class="icon icon-lg icon-rss"></i></a></span>
            -->
            <span>博客内容遵循 <a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">知识共享 署名 - 非商业性 - 相同方式共享 4.0 国际协议</a></span>
        </p>
    </div>
    <div class="bottom">
        <p><span>CollinT &copy; 2017 - 2018</span>
            <span>
                
                Power by <a href="http://hexo.io/" target="_blank">Hexo</a> Theme <a href="https://github.com/yscoder/hexo-theme-indigo" target="_blank">indigo</a>
            </span>
        </p>
    </div>	
</footer>


    </main>
    <div class="mask" id="mask"></div>
<a href="javascript:;" id="gotop" class="waves-effect waves-circle waves-light"><span class="icon icon-lg icon-chevron-up"></span></a>



<div class="global-share" id="globalShare">
    <ul class="reset share-icons">
      <li>
        <a class="weibo share-sns" target="_blank" href="http://service.weibo.com/share/share.php?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&title=《Deploy-storm-on-docker》 — CollinT&pic=http://blog.tangkailin.cn/img/logo.jpg" data-title="微博">
          <i class="icon icon-weibo"></i>
        </a>
      </li>
      <li>
        <a class="weixin share-sns wxFab" href="javascript:;" data-title="微信">
          <i class="icon icon-weixin"></i>
        </a>
      </li>
      <li>
        <a class="qq share-sns" target="_blank" href="http://connect.qq.com/widget/shareqq/index.html?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&title=《Deploy-storm-on-docker》 — CollinT&source=Welcome to contribute to  our documentation on github." data-title=" QQ">
          <i class="icon icon-qq"></i>
        </a>
      </li>
      <li>
        <a class="facebook share-sns" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/" data-title=" Facebook">
          <i class="icon icon-facebook"></i>
        </a>
      </li>
      <li>
        <a class="twitter share-sns" target="_blank" href="https://twitter.com/intent/tweet?text=《Deploy-storm-on-docker》 — CollinT&url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/&via=http://blog.tangkailin.cn" data-title=" Twitter">
          <i class="icon icon-twitter"></i>
        </a>
      </li>
      <li>
        <a class="google share-sns" target="_blank" href="https://plus.google.com/share?url=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/" data-title=" Google+">
          <i class="icon icon-google-plus"></i>
        </a>
      </li>
    </ul>
 </div>


<div class="page-modal wx-share" id="wxShare">
    <a class="close" href="javascript:;"><i class="icon icon-close"></i></a>
    <p>扫一扫，分享到微信</p>
    <img src="//api.qrserver.com/v1/create-qr-code/?data=http://blog.tangkailin.cn/2018/01/23/deploy-storm-on-docker/" alt="微信分享二维码">
</div>




    <script src="//cdn.bootcss.com/node-waves/0.7.4/waves.min.js"></script>
<script>
var BLOG = { ROOT: '/', SHARE: true, REWARD: true };


</script>

<script src="/js/main.min.js?v=1.6.11"></script>


<div class="search-panel" id="search-panel">
    <ul class="search-result" id="search-result"></ul>
</div>
<template id="search-tpl">
<li class="item">
    <a href="{path}" class="waves-block waves-effect">
        <div class="title ellipsis" title="{title}">{title}</div>
        <div class="flex-row flex-middle">
            <div class="tags ellipsis">
                {tags}
            </div>
            <time class="flex-col time">{date}</time>
        </div>
    </a>
</li>
</template>

<script src="/js/search.min.js?v=1.6.11" async></script>






<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>



<script>
(function() {
    var OriginTitile = document.title, titleTime;
    document.addEventListener('visibilitychange', function() {
        if (document.hidden) {
            document.title = 'CollinT';
            clearTimeout(titleTime);
        } else {
            document.title = 'CollinT';
            titleTime = setTimeout(function() {
                document.title = OriginTitile;
            },2000);
        }
    });
})();
</script>



</body>
</html>
